<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Downloading Using the Command Line &mdash; Sarracenia 3.00.40 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Customize File handling with Callbacks." href="2_CLI_with_flowcb_demo.html" />
    <link rel="prev" title="Tutorials" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Sarracenia
          </a>
              <div class="version">
                3.00.40
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Explanation/Overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Downloading Using the Command Line</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#SR3">SR3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2_CLI_with_flowcb_demo.html">Customize File handling with Callbacks.</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_api_flow_demo.html">flow API Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_api_moth_sub_demo.html">A first Example using Sarracenia Moth API</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_api_moth_post_demo.html">Posting from Python Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="Install.html">MetPX-Sarracenia Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Setup_a_local_subscriber.html">Server Admin: A Local Subscriber</a></li>
<li class="toctree-l2"><a class="reference internal" href="Setup_a_remote_subscriber.html">How to setup a Remote Subscriber</a></li>
<li class="toctree-l2"><a class="reference internal" href="Windows.html">Windows user manual</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../How2Guides/index.html">HOWTOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Explanation/index.html">Explanation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contribution/index.html">Contributing to Sarracenia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-documentation.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fr/index.html">En français</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Sarracenia</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Tutorials</a> &raquo;</li>
      <li>Downloading Using the Command Line</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Tutorials/1_CLI_introduction.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Downloading-Using-the-Command-Line">
<h1>Downloading Using the Command Line<a class="headerlink" href="#Downloading-Using-the-Command-Line" title="Permalink to this heading"></a></h1>
<p>This <a class="reference external" href="https://jupyter.org">jupyter notebook</a> introduces <a class="reference external" href="https://metpx.github.io/sarracenia">Sarracenia version 3</a> usage from the command line (mostly on Linux, but should be similar on Windows and Mac also, main difference being different conventions for where preferences and logs are stored. This is probably the easiest way to work with Sarracenia. You configure a flow to download files into a directory, and you can read the directory to process the files there.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sarracenia</span>
<span class="o">!</span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.config/sr3/subscribe
<span class="o">!</span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.cache/sr3/log
</pre></div>
</div>
</div>
<section id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Permalink to this heading"></a></h2>
<p>The above is just a way to get jupyter notebooks to install metpx-sr3 on a server. Creating some directories in case people use API access without running things through the API. The basic pre-requisite is to have metpx-sr3 installed somehow, either as a .deb package, or using pip (or pip3) available to the environment used by jupyter.</p>
<p>The rest of this notebook assumes <a class="reference external" href="https://metpx.github.io/sarracenia">metpx-sr3</a> is installed.</p>
</section>
<section id="SR3">
<h2>SR3<a class="headerlink" href="#SR3" title="Permalink to this heading"></a></h2>
<p>The command line interface is called <a class="reference external" href="../Reference/sr3.1.html">sr3</a> (short for Sarracenia version 3). One defines flows to run using configuration files in a simple format: <em>keyword</em> <em>value</em> format. there are example configurations to get you started:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>sr3<span class="w"> </span>list<span class="w"> </span>examples
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-05-28 15:24:06,526 1914254 [INFO] sarracenia.config finalize overriding batch for consistency with messageCountMax: 10
Sample Configurations: (from: /home/peter/Sarracenia/sr3/sarracenia/examples )
cpump/cno_trouble_f00.inc        flow/amserver.conf
flow/poll.inc                    flow/post.inc
flow/report.inc                  flow/sarra.inc
flow/sender.inc                  flow/shovel.inc
flow/subscribe.inc               flow/watch.inc
flow/winnow.inc                  poll/airnow.conf
poll/aws-nexrad.conf             poll/mail.conf
poll/nasa-mls-nrt.conf           poll/noaa.conf
poll/soapshc.conf                poll/usgs.conf
post/WMO_mesh_post.conf          sarra/wmo_mesh.conf
sender/am_send.conf              sender/ec2collab.conf
sender/pitcher_push.conf         shovel/no_trouble_f00.inc
subscribe/aws-nexrad.conf        subscribe/dd_2mqtt.conf
subscribe/dd_all.conf            subscribe/dd_amis.conf
subscribe/dd_aqhi.conf           subscribe/dd_cacn_bulletins.conf
subscribe/dd_citypage.conf       subscribe/dd_cmml.conf
subscribe/dd_gdps.conf           subscribe/dd_radar.conf
subscribe/dd_rdps.conf           subscribe/dd_swob.conf
subscribe/ddc_cap-xml.conf       subscribe/ddc_normal.conf
subscribe/downloademail.conf     subscribe/ec_ninjo-a.conf
subscribe/hpfxWIS2DownloadAll.conf subscribe/hpfx_amis.conf
subscribe/hpfx_citypage.conf     subscribe/local_sub.conf
subscribe/ping.conf              subscribe/pitcher_pull.conf
subscribe/sci2ec.conf            subscribe/subnoaa.conf
subscribe/subsoapshc.conf        subscribe/subusgs.conf
watch/master.conf                watch/pitcher_client.conf
watch/pitcher_server.conf        watch/sci2ec.conf
</pre></div></div>
</div>
<p>There are different kinds for flows: the examples are classified flow type (poll, post, sarra, sender, shovel…) A <em>subscribe</em> is used by clients to download from a data pump. Let’s pick one of those.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>sr3<span class="w"> </span>add<span class="w"> </span>subscribe/hpfx_amis.conf
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-05-28 15:24:08,749 1914255 [INFO] sarracenia.config finalize overriding batch for consistency with messageCountMax: 10
add: 2023-05-28 15:24:08,750 1914255 [INFO] root add matched existing [&#39;subscribe/hpfx_amis&#39;]
2023-05-28 15:24:08,750 1914255 [ERROR] root add nothing specified to add

</pre></div></div>
</div>
<p>The files that are active for you are place in ~/.config/sr3//config_name. You can browse there and modify them with an editor if you like. You can do that also with <em>sr3 edit subscribe/hpfx_amis.conf</em></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># this is a feed of wmo bulletin (a set called AMIS in the old times)

broker amqps://hpfx.collab.science.gc.ca/
exchange xpublic

# instances: number of downloading processes to run at once.  defaults to 1. Not enough for this case
instances 5

# expire, in operational use, should be longer than longest expected interruption
expire 10m

topic_prefix v02.post
subtopic *.WXO-DD.bulletins.alphanumeric.#
mirror false
directory /tmp/amis/
</pre></div>
</div>
<p>added the messageCountMax, so it doesn’t run forever.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>mkdir<span class="w"> </span>/tmp/amis
<span class="o">!</span><span class="nb">echo</span><span class="w"> </span>messageCountMax<span class="w"> </span><span class="m">10</span><span class="w"> </span>&gt;&gt;~/.config/sr3/subscribe/hpfx_amis.conf
</pre></div>
</div>
</div>
<p>The root directory where files are to be placed needs to exist before you start. the above commands are to configure on a linux machine, you might need something else on a mac or windows.</p>
<p>You can then run a flow interactively with the <em>foreground</em> action, and it will end quickly, like so:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>sr3<span class="w"> </span>foreground<span class="w"> </span>subscribe/hpfx_amis.conf
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-05-28 15:24:16,821 1914260 [INFO] sarracenia.config finalize overriding batch for consistency with messageCountMax: 10
.2023-05-28 15:24:16,928 [INFO] 1914261 sarracenia.config finalize overriding batch for consistency with messageCountMax: 10
2023-05-28 15:24:16,934 [INFO] 1914261 sarracenia.config finalize overriding batch for consistency with messageCountMax: 10
2023-05-28 15:24:16,934 [INFO] 1914261 sarracenia.flow loadCallbacks flowCallback plugins to load: [&#39;sarracenia.flowcb.gather.message.Message&#39;, &#39;sarracenia.flowcb.retry.Retry&#39;, &#39;sarracenia.flowcb.housekeeping.resources.Resources&#39;, &#39;log&#39;]
2023-05-28 15:24:17,111 [INFO] 1914261 sarracenia.moth.amqp __getSetup queue declared q_anonymous_subscribe.hpfx_amis.69643324.61538382 (as: amqps://anonymous@hpfx.collab.science.gc.ca/)
2023-05-28 15:24:17,111 [INFO] 1914261 sarracenia.moth.amqp __getSetup binding q_anonymous_subscribe.hpfx_amis.69643324.61538382 with v02.post.*.WXO-DD.bulletins.alphanumeric.# to xpublic (as: amqps://anonymous@hpfx.collab.science.gc.ca/)
2023-05-28 15:24:17,147 [INFO] 1914261 sarracenia.flowcb.log __init__ subscribe initialized with: {&#39;post&#39;, &#39;after_post&#39;, &#39;after_accept&#39;, &#39;after_work&#39;, &#39;on_housekeeping&#39;}
2023-05-28 15:24:17,147 [INFO] 1914261 sarracenia.flow run callbacks loaded: [&#39;sarracenia.flowcb.gather.message.Message&#39;, &#39;sarracenia.flowcb.retry.Retry&#39;, &#39;sarracenia.flowcb.housekeeping.resources.Resources&#39;, &#39;log&#39;]
2023-05-28 15:24:17,147 [INFO] 1914261 sarracenia.flow run pid: 1914261 subscribe/hpfx_amis.conf instance: 0
2023-05-28 15:24:17,168 [INFO] 1914261 sarracenia.flow run now active on vip None
2023-05-28 15:24:18,332 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 1.11 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SA/CWAO/19/SAZZ40_CWAO_281900_RRW_EFOU_64642
2023-05-28 15:24:18,333 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 1.62 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SX/KWAL/19/SXVX40_KWAL_281923___12624
2023-05-28 15:24:18,333 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 1.62 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SN/KWNB/19/SNVD20_KWNB_281900_RRL__24342
2023-05-28 15:24:18,333 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 0.61 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SA/KWBC/19/SAUS70_KWBC_281924_RRA__30100
2023-05-28 15:24:18,333 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 0.61 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SR/KWAL/19/SRCN40_KWAL_281923___8005
2023-05-28 15:24:18,333 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 0.61 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SR/KWAL/19/SRND20_KWAL_281923___24712
2023-05-28 15:24:18,333 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 0.60 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/UA/CWAO/19/UANT01_CWAO_281924___00310
2023-05-28 15:24:18,333 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 0.20 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SA/KWBC/19/SAUS80_KWBC_281924___64946
2023-05-28 15:24:18,949 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SAZZ40_CWAO_281900_RRW_EFOU_64642
2023-05-28 15:24:18,949 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SXVX40_KWAL_281923___12624
2023-05-28 15:24:18,949 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SNVD20_KWNB_281900_RRL__24342
2023-05-28 15:24:18,949 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SAUS70_KWBC_281924_RRA__30100
2023-05-28 15:24:18,949 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SRCN40_KWAL_281923___8005
2023-05-28 15:24:18,949 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SRND20_KWAL_281923___24712
2023-05-28 15:24:18,949 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/UANT01_CWAO_281924___00310
2023-05-28 15:24:18,949 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SAUS80_KWBC_281924___64946
2023-05-28 15:24:19,118 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 0.99 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SX/KWNB/19/SXUS23_KWNB_281900_RRX__36309
2023-05-28 15:24:19,119 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 0.99 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SP/KWBC/19/SPUS80_KWBC_281924___40647
2023-05-28 15:24:19,119 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 0.99 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SR/KWAL/19/SRCN40_KWAL_281923___38440
2023-05-28 15:24:19,119 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 1.64 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SO/KWNB/19/SOVD83_KWNB_281800_RRX__64658
2023-05-28 15:24:19,119 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 1.63 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/FZ/KCAR/19/FZUS51_KCAR_281923___54451
2023-05-28 15:24:19,119 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 1.62 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SR/KWAL/19/SRCN40_KWAL_281923___2520
2023-05-28 15:24:19,119 [INFO] 1914261 sarracenia.flowcb.log after_accept accepted: (lag: 1.61 ) https://hpfx.collab.science.gc.ca /20230528/WXO-DD/bulletins/alphanumeric/20230528/SN/KWNB/19/SNVD20_KWNB_281900_RRM__27859
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SXUS23_KWNB_281900_RRX__36309
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SPUS80_KWBC_281924___40647
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SRCN40_KWAL_281923___38440
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SOVD83_KWNB_281800_RRX__64658
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/FZUS51_KCAR_281923___54451
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SRCN40_KWAL_281923___2520
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flowcb.log after_work downloaded ok: /tmp/hpfx_amis/SNVD20_KWNB_281900_RRM__27859
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flow please_stop ok, telling 4 callbacks about it.
2023-05-28 15:24:19,790 [INFO] 1914261 sarracenia.flow run starting last pass (without gather) through loop for cleanup.
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flow please_stop ok, telling 4 callbacks about it.
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flow run on_housekeeping pid: 1914261 subscribe/hpfx_amis.conf instance: 0
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.gather.message on_housekeeping messages: good: 15 bad: 0 bytes: 2.1 KiB average: 140 Bytes
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.retry on_housekeeping on_housekeeping
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.diskqueue on_housekeeping work_retry_00 on_housekeeping
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.diskqueue on_housekeeping No retry in list
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.diskqueue on_housekeeping on_housekeeping elapse 0.000105
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.diskqueue on_housekeeping post_retry_000 on_housekeeping
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.diskqueue on_housekeeping No retry in list
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.diskqueue on_housekeeping on_housekeeping elapse 0.000077
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.housekeeping.resources on_housekeeping Current Memory cpu_times: user=0.13 system=0.05
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.housekeeping.resources on_housekeeping Current mem usage: 54.6 MiB, accumulating count (15 or 15/100 so far) before self-setting threshold
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.log stats version: 3.00.40, started: 2 seconds ago, last_housekeeping:  2.6 seconds ago
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.log stats messages received: 15, accepted: 15, rejected: 0   rate accepted: 100.0% or 5.7 m/s
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.log stats files transferred: 15 bytes: 12.2 KiB rate: 4.6 KiB/sec
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.log stats lag: average: 1.09, maximum: 1.64
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flowcb.log on_housekeeping housekeeping
2023-05-28 15:24:19,791 [INFO] 1914261 sarracenia.flow run clean stop from run loop
2023-05-28 15:24:19,816 [INFO] 1914261 sarracenia.flowcb.gather.message on_stop closing
2023-05-28 15:24:19,816 [INFO] 1914261 sarracenia.flow close flow/close completed cleanly pid: 1914261 subscribe/hpfx_amis.conf instance: 0

</pre></div></div>
</div>
<p>as you can see it downloaded five files to /tmp/amis. The <em>foreground</em> action is intended to help with debugging, rather than real operations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>sr3<span class="w"> </span>status
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-05-28 15:24:25,480 1914273 [INFO] sarracenia.config finalize overriding batch for consistency with messageCountMax: 10
status:
Component/Config                         Processes   Connection        Lag                Rates
                                         State   Run Retry  msg data   LagMax  LagAvg  %rej     pubsub   messages     RxData     TxData
                                         -----   --- -----  --- ----   ------  ------  ----   --------       ----     ------     ------
subscribe/hpfx_amis                      stop    0/0     0 100%  17%    1.64s    1.09s  0.0% 252 Bytes/s   1 msgs/s  1.5 KiB/s  0 Bytes/s
      Total Running Configs:   0 ( Processes: 0 missing: 0 stray: 0 )
                     Memory: uss:0 Bytes rss:0 Bytes vms:0 Bytes
                   CPU Time: User:0.00s System:0.00s
           Pub/Sub Received: 252 msgs/s (252 Bytes/s), Sent:  0 msgs/s (0 Bytes/s)
              Data Received: 1 Files/s (1.5 KiB/s), Sent: 0 Files/s (0 Bytes/s)
</pre></div></div>
</div>
<p>There is 1 configuration in your list. You can have hundreds. The columns on the right refer to how many instances you have for each configuration. In the example above <em>instances</em> is set to 5, so one would expect to see 5 running instances when it would be running. You can start specifc configuration with _sr3 start subscribe/<em>_ or start all active instances with: *sr3 start</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>sr3<span class="w"> </span>log<span class="w"> </span>subscribe/hpfx_amis.conf
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2023-05-28 15:24:34,478 1914274 [INFO] sarracenia.config finalize overriding batch for consistency with messageCountMax: 10
tail: cannot open &#39;/home/peter/.cache/sr3/log/subscribe_hpfx_amis_01.log&#39; for reading: No such file or directory
tail: no files remaining
2023-05-28 15:24:34,479 1914274 [CRITICAL] root run_command subprocess.run failed err=Command &#39;[&#39;tail&#39;, &#39;-f&#39;, &#39;/home/peter/.cache/sr3/log/subscribe_hpfx_amis_01.log&#39;]&#39; returned non-zero exit status 1.

</pre></div></div>
</div>
<p>When running in the background, output needs to go a log file. As we have only run this configuration file in the foreground, asking to see the log prints an error about the log being missing. This tells you that the logs are in the <em>~/.cache/sr3/log</em> directory. Logs can be monitored in real-time with traditional tools such as <em>tail -f</em> or <em>grep</em>.</p>
<p><em>sr3 stop</em> does what you expect.</p>
<p>Processes can crash. In the <em>sr3 status</em> output above, if the number of processes in the Run column is less than in the Exp (for Expected) one, then it means that some instances have crashed. you can repair it (just start the missing instances) with:</p>
<p><em>sr3 sanity</em> – start missing instances, also kill strays if any found.</p>
<p>So that’s it, an introduction to running configurations in Sarracenia from the command line.</p>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this heading"></a></h2>
<p>If all you want to do is obtain data from a data pump in real-time, using the command line interface to control some processes that run all the time, so that they dump files in a certain directory is the easiest way to go.</p>
<p>It isn’t very efficient though. When you have large numbers of files to work with, and you want high speed processing, it is better, in the sense of lower cpu and i/o overhead, and in terms of speed of processing, to have your own application informed of the arrival of files, rather than scanning a directory.</p>
<p>The easiest way to do that is to add some callbacks to your flows. We’ll cover that next.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="2_CLI_with_flowcb_demo.html" class="btn btn-neutral float-right" title="Customize File handling with Callbacks." accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Shared Services Canada, Government of Canada, GPLv2.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>